# 从零开始裸机编程

**本节知识清单**

请尝试回答以下问题

- 如何使得函数返回时能够跳转到调用该函数的下一条指令，即使该函数在代码中的多个位置被调用？
- 对于一个函数而言，保证它调用某个子函数之前，以及该子函数返回到它之后（某些）通用寄存器的值保持不变有何意义？
- 调用者函数和被调用者函数如何合作保证调用子函数前后寄存器内容保持不变？调用者保存和被调用者保存寄存器的保存与恢复各自由谁负责？它们暂时被保存在什么位置？它们于何时被保存和恢复（如函数的开场白/退场白）？
- 在 RISC-V 架构上，调用者保存和被调用者保存寄存器如何划分的？
- sp 和 ra 是调用者还是被调用者保存寄存器，为什么这样约定？
- 如何使用寄存器传递函数调用的参数和返回值？如果寄存器数量不够用了，如何传递函数调用的参数？

函数调用不同于一般的控制流，我们不知道何时发生函数调用，即使知道何时发生函数调用，也不能确定调用后的下一条地址在那里，这取决于，发生函数调用的代码。

通过jalr指令，保存返回地址并实现跳转。

ret伪指令实现回到跳转之前的下一条指令。

将由于函数调用，在控制流转移前后需要保持不变的寄存器集合称为函数调用上下文。

调用函数，首先保存不想被改变的寄存器，即调用者保存寄存器

被调函数，保存用到的寄存器的值？退出前将这些寄存器恢复



# lab3

花了整整四天终于吧lab3过了...

   .space 4096 * 32

将内核栈扩大了一倍解决

还有就是一直给我莫名奇妙报错，更新rust snalyzer后解决，但是不应该会影响我ci的结果阿。

# lab4

## 